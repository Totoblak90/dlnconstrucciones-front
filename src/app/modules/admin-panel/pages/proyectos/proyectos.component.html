<div class="row">
  <div class="col" *ngIf="!isEditing && !isCreating">
    <div class="card">
      <div class="card-body">
        <app-table
          *ngIf="projects && tableData"
          title="Proyectos"
          [encabezadosTabla]="encabezadosTabla"
          [filasTabla]="tableData"
          [totalSection]="projects?.length!"
          [loading]="loading"
          [noImage]="true"
          (onRecargar)="recargarProyectos($event)"
          (onCreate)="crearProyecto()"
          (onEdit)="editarProyecto($event)"
          (onDelete)="borrarProyecto($event)"
        ></app-table>
      </div>
    </div>
  </div>
  <div class="col" *ngIf="isCreating || isEditing">
    <div class="card">
      <div class="card-header">
        <h1 class="primary-dark">{{ crudAction }} Proyecto/s</h1>
      </div>
      <div class="card-body">
        <form
          class="form p-t-20 form-material"
          [formGroup]="proyectForm"
          (ngSubmit)="formSubmit()"
        >
          <div class="card-body">
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="userSelectInput">Usuario*</label>
                  <select
                    formControlName="user"
                    class="form-control custom-select"
                    id="userSelectInput"
                  >
                    <option [value]="null">--Seleccionar un usuario--</option>
                    <option
                      *ngFor="let project of projects"
                      [value]="project.Users?.id!"
                    >
                      {{
                        project.Users?.first_name! +
                          " " +
                          project.Users?.last_name! +
                          " / email: " +
                          project.Users?.email!
                      }}
                    </option>
                  </select>
                  <div class="p-2">
                    <span
                      class="text-danger"
                      *ngIf="
                        proyectForm.controls.user.errors?.required &&
                        proyectForm.controls.user.touched
                      "
                      >Este dato es requerido</span
                    >
                  </div>
                </div>
                <div class="form-group">
                  <label *ngIf="crudAction === 'Editar'" for="titleInput"
                    >Título*</label
                  >
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Título"
                      formControlName="title"
                      id="titleInput"
                    />
                    <div class="p-2">
                      <span
                        class="text-danger"
                        *ngIf="
                          proyectForm.controls.title.errors?.required &&
                          proyectForm.controls.title.touched
                        "
                        >Este campo es requerido</span
                      >
                      <span
                        class="text-danger"
                        *ngIf="
                          proyectForm.controls.title.errors?.minlength &&
                          proyectForm.controls.title.touched
                        "
                        >Debe tener al menos 6 caracteres</span
                      >
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label
                    *ngIf="crudAction === 'Editar'"
                    for="descriptionTextArea"
                    >Descripción</label
                  >
                  <div class="input-group">
                    <textarea
                      class="form-control"
                      id="descriptionTextArea"
                      placeholder="Descripción"
                      formControlName="description"
                      cols="30"
                      rows="5"
                    ></textarea>
                    <div class="p-2">
                      <span
                        class="text-danger"
                        *ngIf="
                          proyectForm.controls.description.errors?.minlength &&
                          proyectForm.controls.description.touched
                        "
                        >Debe tener al menos 6 caracteres</span
                      >
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label *ngIf="crudAction === 'Editar'" for="totalInput"
                    >Total*</label
                  >
                  <div class="input-group">
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Total"
                      formControlName="total"
                      id="totalInput"
                    />
                    <div class="p-2">
                      <span
                        class="text-danger"
                        *ngIf="
                          proyectForm.controls.total.errors?.required &&
                          proyectForm.controls.total.touched
                        "
                        >Este campo es requerido</span
                      >
                      <span
                        class="text-danger"
                        *ngIf="
                          proyectForm.controls.total.errors?.min &&
                          proyectForm.controls.total.touched
                        "
                        >El valor debe ser mayor a 0</span
                      >
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label *ngIf="crudAction === 'Editar'" for="cashFlowInput"
                    >Cashflow</label
                  >
                  <div class="input-group">
                    <input
                      type="file"
                      class="form-control"
                      placeholder="Cashflow"
                      formControlName="cashflow"
                      id="cashFlowInput"
                      (change)="validateCashflowExtension($event)"
                    />
                    <div class="p-2">
                      <span class="text-danger" *ngIf="!acceptedFileTypes"
                        >Los formatos aceptados son PDF o XLSX</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button
              type="submit"
              class="btn btn-success waves-effect waves-light m-r-10 bgc-primary-dark"
            >
              Confirmar
            </button>
            <button
              type="button"
              (click)="recargarProyectos(true)"
              class="btn btn-danger waves-effect waves-light m-r-10"
            >
              Volver
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
